[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0

[program:whisper_backend]
command=python3 -u server/WhisperLive/run_server.py --port 4000 --backend faster_whisper
directory=/app
autostart=true
autorestart=true
priority=10
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:express_backend]
# Start Express directly - it will handle Whisper connection gracefully
command=node server/index.js
directory=/app
autostart=true
autorestart=true
priority=20
# Add a startup delay to give Whisper time to start
startsecs=5
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0


[program:asterisk]
command=/usr/sbin/asterisk -f -vvv  ; Run in foreground with verbose logging for debug
directory=/etc/asterisk
autostart=true
autorestart=true
startretries=3
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
user=root  ; Or a non-root user if you set permissions
priority=999